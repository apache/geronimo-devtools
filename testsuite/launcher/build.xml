<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one or more
  ~ contributor license agreements.  See the NOTICE file distributed with
  ~ this work for additional information regarding copyright ownership.
  ~ The ASF licenses this file to You under the Apache License, Version 2.0
  ~ (the "License"); you may not use this file except in compliance with
  ~ the License.  You may obtain a copy of the License at
  ~
  ~    http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<!--
 |
 | Ant script to start Eclipse via the Equinox launcher
 |
 |
 | @version $Rev$ $Date$
 |
 -->
<project name="GEP Automated Testsuite Launcher" default="launch" >

    <condition property="isMac" >
        <os family="mac" />
    </condition>

    <condition property="isUnix" >
        <os family="unix" />
    </condition>

    <condition property="isWindows" >
        <os family="windows" />
    </condition>

    <!--
     |
     | Copy and rename the eqiunox launcher jar,
     | Copy and rename the org.eclipse.test folder
     |
     -->
    <target name="init">
        <!-- Prompt to install aries tools manually -->
        <input>
&#10;
Please install Aries tools manually for eclipse under testsuite/launcher/eclipse,
&#10;
Free Aries tools download URL is http://www.ibm.com/developerworks/rational/downloads/10/rationaldevtoolsforosgiapplications.html

Press Enter to continue...
        </input>

        <property name="eclipse-home" value="eclipse"/>
        <copy tofile="${eclipse-home}/eclipse/plugins/org.eclipse.equinox.launcher.jar">
            <fileset dir="${eclipse-home}/eclipse/plugins"
              includes="**/org.eclipse.equinox.launcher_*.jar"/>
        </copy>
        <mkdir dir="${eclipse-home}/eclipse/plugins/org.eclipse.test"/>
        <copy todir="${eclipse-home}/eclipse/plugins/org.eclipse.test">
            <fileset dir="${eclipse-home}/eclipse/plugins/org.eclipse.test_3.3.0"/>
        </copy>
    </target>

    <target name="setOSproperties" >
        <antcall target="mac" />
        <antcall target="unix" />
        <antcall target="windows" />
    </target>

    <target name="mac" if="isMac" >
        <property name="osName" value="mac" />
        <property name="os_property" value="macosx" />
        <property name="ws_property" value="cocoa" />
    </target>
    <target name="unix" if="isUnix" >
        <property name="osName" value="unix" />
        <property name="os_property" value="linux" />
        <property name="ws_property" value="gtk" />
    </target>

    <target name="windows" if="isWindows" >
        <property name="osName" value="windows" />
        <property name="os_property" value="win32" />
        <property name="ws_property" value="win32" />
    </target>

    <!--
     |
     | Start Eclipse via the Equinox launcher
     |
     -->
    <target name="launch" depends="init, setOSproperties" description="Start Equinox launcher">
        <echo>
Launching Equinox on ${osName} with -Dos=${os_property} -Dws=${ws_property}
        </echo>
        <java classname="org.eclipse.equinox.launcher.Main"
              failonerror="true"
              fork="true">
            <classpath>
                <pathelement path="${eclipse-home}/eclipse/plugins/org.eclipse.equinox.launcher.jar"/>
            </classpath>
            <arg line="-data workspace" />
            <arg line="-application org.eclipse.ant.core.antRunner"/>
            <arg line="-file testsuite.xml"/>
            <arg value="all"/>
            <arg value="-Dos=${os_property}"/>
            <arg value="-Dws=${ws_property}"/>
            <arg value="-Darch=x86"/>
        </java>
    </target>

</project>

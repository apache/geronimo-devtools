<?xml version="1.0" encoding="ISO-8859-1"?>
<project default="default"
    xmlns:j="jelly:core"
    xmlns:ant="jelly:ant">

    <goal name="default">
        <attainGoal name="build"/>
    </goal>    
    
    <goal name="build">     
        <attainGoal name="jar:install"/>
    </goal>
    
    <preGoal name="java:jar-resources"> 
        <attainGoal name="createpluginxml"/>       
        <attainGoal name="copyjars"/>
    </preGoal>

    <goal name="rebuild">
        <attainGoal name="clean"/>
        <attainGoal name="build"/>
    </goal>
        
    <preGoal name="clean:clean">        
        <ant:delete dir="${basedir}/lib"/>    
        <ant:delete file=".classpath"/>
        <ant:delete file=".project"/>
    </preGoal>
    
    <postGoal name="eclipse:generate-classpath">
      <replaceregexp file=".classpath" match='(classpathentry) (kind="var")' replace='\1 exported="true" \2' byline="true"/>
    </postGoal>
    
    <goal name="createpluginxml">
      <ant:copy file="plugin.xml.template" tofile="plugin.xml" overwrite="true"/>
      <replaceregexp file="plugin.xml" match="@runtime.v1.plugin.version@" replace="${distributionjarversion}" byline="true"/>
      <replaceregexp file="plugin.xml" match="@geronimo_runtime_version@" replace="${geronimo_runtime_version}" byline="true"/>
      <replaceregexp file="plugin.xml" match="@geronimo_spec_version@" replace="${geronimo_spec_version}" byline="true"/>
      <replaceregexp file="plugin.xml" match="@mx4j_version@" replace="${mx4j_version}" byline="true"/>  
      <replaceregexp file="plugin.xml" match="@commons_logging_version@" replace="${commons_logging_version}" byline="true"/>   
      <replaceregexp file="plugin.xml" match="@cglib_version@" replace="${cglib_version}" byline="true"/>      
    </goal>
    
    <goal name="copyjars">        
        <j:forEach var="artifact" items="${pom.artifacts}">  
          <ant:copy todir="${basedir}/lib" file="${artifact.path}"/>          
        </j:forEach>                 
    </goal>  
     
</project>
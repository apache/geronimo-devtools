<?xml version="1.0" encoding="ISO-8859-1"?>
<project default="default"
    xmlns:j="jelly:core"
    xmlns:ant="jelly:ant">

    <goal name="default">
        <attainGoal name="build"/>
    </goal>
    
    <goal name="jar:install">
        <attainGoal name="build"/>
    </goal>

    <goal name="build">
        <attainGoal name="copyjars"/>
        <attainGoal name="zipdistribution"/>
        <attainGoal name="deploy"/>
    </goal>

    <goal name="rebuild">
        <attainGoal name="clean"/>
        <attainGoal name="build"/>
    </goal>

    <goal name="copyjars">      
        <ant:echo>Creating deployable feature</ant:echo>  
        <j:forEach var="artifact" items="${pom.artifacts}">        
            <j:set var="dependency" value="${artifact.dependency}"/>           
            
            <j:if test="${dependency.getProperty('feature') == 'true'}">  
                <ant:unjar src="${artifact.path}" dest="${feature.assembly.distributions.dir}/features/${dependency.artifactId}_${dependency.version}"/>
            </j:if> 
            
            <j:if test="${dependency.getProperty('jar') == 'true'}">  
                <ant:copy file="${artifact.path}" tofile="${feature.assembly.distributions.dir}/plugins/${dependency.artifactId}_${dependency.version}.jar"/>
            </j:if> 
            
            <j:if test="${dependency.getProperty('jar') == 'false'}">  
                <ant:unjar src="${artifact.path}" dest="${feature.assembly.distributions.dir}/plugins/${dependency.artifactId}_${dependency.version}"/>
            </j:if>                        
        </j:forEach>                 
    </goal>  
    
    <goal name="zipdistribution">
       <ant:echo>Packaging deployable feature</ant:echo>  
       <ant:zip destfile="${maven.build.dir}/geronimo-server-adapter_${pom.currentVersion}.zip" basedir="${feature.assembly.distributions.dir}"/>           
    </goal>
    
    <goal name="deploy">
       <ant:echo>Deploying binary zip distribution</ant:echo>  
    </goal>
     
</project>

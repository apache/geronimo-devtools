<?xml version="1.0" encoding="ISO-8859-1"?>
<project default="default"
    xmlns:j="jelly:core"
    xmlns:ant="jelly:ant">

    <goal name="default">
        <attainGoal name="build"/>
    </goal>
    
    <goal name="jar:install">
        <attainGoal name="build"/>
    </goal>

    <goal name="build">
        <attainGoal name="copyjars"/>
        <attainGoal name="zipdisto"/>
        <attainGoal name="sitedistro"/>
    </goal>

    <goal name="rebuild">
        <attainGoal name="clean"/>
        <attainGoal name="build"/>
    </goal>

    <goal name="zipdistro">   
        <ant:echo>Packaging feature for zip distribution</ant:echo>    
        <j:forEach var="artifact" items="${pom.artifacts}">        
            <j:set var="dependency" value="${artifact.dependency}"/>           
            
            <j:if test="${dependency.getProperty('feature') == 'true'}">  
                <ant:unjar src="${artifact.path}" dest="${feature.assembly.distributions.dir}/features/${dependency.artifactId}_${distributionjarversion}"/>
            </j:if> 
            
            <j:if test="${dependency.getProperty('jar') == 'true'}">  
                <ant:copy file="${artifact.path}" tofile="${feature.assembly.distributions.dir}/plugins/${dependency.artifactId}_${distributionjarversion}.jar"/>
            </j:if> 
            
            <j:if test="${dependency.getProperty('jar') == 'false'}">  
                <ant:unjar src="${artifact.path}" dest="${feature.assembly.distributions.dir}/plugins/${dependency.artifactId}_${distributionjarversion}"/>
            </j:if>                        
        </j:forEach>       
        
         <ant:zip destfile="${maven.build.dir}/geronimo-eclipse-plugin-${pom.currentVersion}.zip" basedir="${feature.assembly.distributions.dir}"/>           
    </goal>  
    
    <goal name="sitedistro">
       <ant:echo>Packaging feature for update site</ant:echo>  
        <j:forEach var="artifact" items="${pom.artifacts}">        
            <j:set var="dependency" value="${artifact.dependency}"/>           
            
            <j:if test="${dependency.getProperty('feature') == 'true'}">  
                <ant:copy file="${artifact.path}" tofile="${feature.site.distributions.dir}/features/${dependency.artifactId}_${distributionjarversion}.jar"/>
            </j:if> 
            
            <j:if test="${dependency.getProperty('jar') == 'true' || dependency.getProperty('jar') == 'false'}">  
                <ant:copy file="${artifact.path}" tofile="${feature.site.distributions.dir}/plugins/${dependency.artifactId}_${distributionjarversion}.jar"/>
            </j:if>                      
        </j:forEach>  
        <ant:zip destfile="${maven.build.dir}/geronimo-sitedistro-${pom.currentVersion}.zip" basedir="${feature.site.distributions.dir}"/>                    
    </goal>
     
</project>
